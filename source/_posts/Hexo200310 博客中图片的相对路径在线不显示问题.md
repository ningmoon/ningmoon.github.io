---
title: Hexo博客中图片的相对路径在线不显示问题
catalog: true
comments: true
date: 2020-03-10 08:00:00
subtitle: Hexo-asset-image plugin
header-img: hexo-bg.jpg
tags:
- Hexo
- Blog
categories:
- Hexo

---
![The First Title Picture](Hexo200310 博客中图片的相对路径在线不显示问题/200310-1.jpg)

<!-- more -->

**本文介绍Blog中图片引用问题**

#引用图片的几种方式

**a.直接通过网络链接图片，如下：**

```
![The First Title Picture](https://raw.githubusercontent.com/yourusername/yourrepository/master/hexo-0001.png "Optional Title")
```

**b.在线显示**

这种方式在hexo g之后会在线显示，但是不会编辑的时候实时显示图片

```
![The First Title Picture](./img.jpg)

```

**c.实时显示**

这种方式会实时显示图片，但是不会在线生成图片

```
![The First Title Picture](your_article_folder/img.jpg)
```

#常见的图片引用问题

上面的b和c出现的问题，如何结合两者，使得图片实时显示的同时又可以在线实现，我们需要如下的插件：

`hexo-asset-image`

**安装**
可以参考[官方地址](https://github.com/xcodebuild/hexo-asset-image)

`npm install hexo-asset-image --save`

然后就可以直接用上述c的方法进行引用图片，但是会出现如下的错误：

```
update link as:-->/.io//06/01/vim/1561905818946.png
update link as:-->/.io//06/01/vim/1561905818946.png
```

即使hexo clean，问题还是依然存在

**原因是：**

> 应该是hexo-asset-image这个插件的bug,hexo版本3.0以上获取网站url的方式与3.0以下有些不同，照着文章修改hexo.js的index.js就行，或者直接卸载hexo-asset-image，选择使用hexo 3.0方式的标签插件应该也可以

所以我们需要在下载了插件之后，对插件中的一些配置文件进行修改，不然这个插件可能会出Bug

**打开/node_modules/hexo-asset-image/index.js，将内容更换为下面的代码**
```
'use strict';
var cheerio = require('cheerio');

// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string
function getPosition(str, m, i) {
  return str.split(m, i).join(m).length;
}

var version = String(hexo.version).split('.');
hexo.extend.filter.register('after_post_render', function(data){
  var config = hexo.config;
  if(config.post_asset_folder){
    	var link = data.permalink;
	if(version.length > 0 && Number(version[0]) == 3)
	   var beginPos = getPosition(link, '/', 1) + 1;
	else
	   var beginPos = getPosition(link, '/', 3) + 1;
	// In hexo 3.1.1, the permalink of "about" page is like ".../about/index.html".
	var endPos = link.lastIndexOf('/') + 1;
    link = link.substring(beginPos, endPos);

    var toprocess = ['excerpt', 'more', 'content'];
    for(var i = 0; i < toprocess.length; i++){
      var key = toprocess[i];
 
      var $ = cheerio.load(data[key], {
        ignoreWhitespace: false,
        xmlMode: false,
        lowerCaseTags: false,
        decodeEntities: false
      });

      $('img').each(function(){
		if ($(this).attr('src')){
			// For windows style path, we replace '\' to '/'.
			var src = $(this).attr('src').replace('\\', '/');
			if(!/http[s]*.*|\/\/.*/.test(src) &&
			   !/^\s*\//.test(src)) {
			  // For "about" page, the first part of "src" can't be removed.
			  // In addition, to support multi-level local directory.
			  var linkArray = link.split('/').filter(function(elem){
				return elem != '';
			  });
			  var srcArray = src.split('/').filter(function(elem){
				return elem != '' && elem != '.';
			  });
			  if(srcArray.length > 1)
				srcArray.shift();
			  src = srcArray.join('/');
			  $(this).attr('src', config.root + link + src);
			  console.info&&console.info("update link as:-->"+config.root + link + src);
			}
		}else{
			console.info&&console.info("no src attr, skipped...");
			console.info&&console.info($(this));
		}
      });
      data[key] = $.html();
    }
  }
});
```

最后不要忘记了
`post_asset_folder: true`

#PS
最后可以参考[这篇文章](https://blog.csdn.net/xjm850552586/article/details/84101345)和[这篇文章](https://segmentfault.com/q/1010000019625231/a-1020000019625326)。


